{% extends "base.html" %}
{% load static %}

{% block title %}
    {{ post.title }}
{% endblock %}

{% block style_script %}
    <script defer src="{% static "js/comment.js" %}"></script>
{% endblock style_script %}

{% block content %}
    <p class="source">
        <a href="{% url 'branch' post.branch.name %}" class="branch-link">fl/{{ post.branch.name }}</a>
    </p>
    <h2 style="font-size: 26px; color: #fff;">{{ post.title }}</h2>
    

    <p class="source">
        Posted by <strong>{{ post.user.username }}</strong>
    </p>
    <p class="meta">{{ post.date|date:"F j, Y, H:i" }}</p>

    {% with images=post.image_set.all %}
    {% if images|length > 1 %}
                        <div class="carousel-wrapper">
                            <div id="carouselExample{{ forloop.counter }}" class="carousel slide">
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <img src="{{ images.0.image.url }}" class="d-block w-100" alt="{{ post.title }}">
                                    </div>
                                    {% for image in images|slice:'1:' %}
                                        <div class="carousel-item">
                                            <img src="{{ image.image.url }}" class="d-block w-100" alt="{{ post.title }}">
                                        </div>
                                    {% endfor %}
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample{{ forloop.counter }}" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#carouselExample{{ forloop.counter }}" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            </div>
                        </div>
                    {% elif images|length == 1 %}
                        <div class="carousel-wrapper">
                            <img src="{{ images.0.image.url }}" class="d-block w-100" alt="{{ post.title }}">
                        </div>
                    {% endif %}
                    {% endwith %}

    <div class="post-body">
        {{ post.body|linebreaks }}
    </div>

    {% if control %}
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Delete
        </button>

        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Delete?</p>
            </div>
            <div class="modal-footer">
                <form action="" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <button type="submit" class="btn btn-primary" name="delete" value="true">Yes</button>
                </form>
            </div>
            </div>
        </div>
        </div>
    {% endif %}

    <h2>Comments</h2>
    

    <form id="comment-form">
    {% csrf_token %}
    <div class="form-floating">
        <textarea class="form-control" placeholder="Leave a comment here" name="comment_text"></textarea>
        <label for="floatingTextarea">Comments</label>
        <input type="hidden" name="post_id" value="{{ post.id }}">
    </div>
    <br>
    <button type="submit" class="btn btn-primary">Submit</button>
    </form>

    <ul id="comments-list">
    {% for comment in comments %}
        <li><strong>{{ comment.user.username }}</strong>: {{ comment.text }}</li>
    {% endfor %}
    </ul>
{% endblock %}
